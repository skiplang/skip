#!/bin/bash

echo "-------------------------------------------------------------------------------"
echo "- CONFIGURE BUILD FOR SKIP -"
echo "-------------------------------------------------------------------------------"

rm -f Makefile.config
touch Makefile.config

CLANG=`which clang`
EXPVERSION=5

if [ -f $CLANG ]; then
    VERSION=`$CLANG --version | grep version | sed 's/[^0-9]*\([0-9]*\).*/\1/'`
    if [ $((VERSION)) -lt $((EXPVERSION)) ]; then
	echo "ERROR: clang compiler version is too old!"
	echo "ERROR: SKIP needs at least version $EXPVERSION"
	echo "ERROR: your version is $VERSION"
	exit 2
    fi
    echo "clang compiler found: $CLANG"
else
    echo "ERROR: clang compiler not found"
    exit 2
fi

CLANGXX=`which clang++`

if [ -f $CLANGXX ]; then
    VERSION=`$CLANGXX --version | grep version | sed 's/[^0-9]*\([0-9]*\).*/\1/'`
    if [ $((VERSION)) -lt $((EXPVERSION)) ]; then
	echo "ERROR: clang compiler version is too old!"
	echo "ERROR: SKIP needs at least version $EXPVERSION"
	echo "ERROR: your version is $VERSION"
	exit 2
    fi
    echo "clang++ compiler found: $CLANGXX"
else
    echo "ERROR: clang++ compiler not found"
    exit 2
fi

RANLIB=`which ranlib`

if [ -f $RANLIB ]; then
    echo "ranlib found: $RANLIB"
else
    echo "ERROR: ranlib not found"
    exit 2
fi

AR=`which ar`

if [ -f $AR ]; then
    echo "ar found: $AR"
else
    echo "ERROR: ar not found"
    exit 2
fi

echo "CC:=$CLANG" >> Makefile.config
echo "CXX:=$CLANGXX" >> Makefile.config
echo "CLANGXX:=$CLANGXX" >> Makefile.config
echo "RANLIB:=$RANLIB" >> Makefile.config
echo "AR:=$AR" >> Makefile.config

if [ "$(uname)" == "Darwin" ]; then
    echo "LIBUNWIND:=" >> Makefile.config
else
    echo "LIBUNWIND:=subbuild/lib/libunwind.a" >> Makefile.config
fi

echo "INCLUDEPATH:= -I$ICUDIR" >> Makefile.config

if [ -z "$PREFIX" ]; then
    echo "PREFIX:=/usr/local" >> Makefile.config
else
    echo "PREFIX:=$PREFIX"
fi
